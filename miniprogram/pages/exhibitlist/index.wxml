<!-- index.wxml -->
<page-meta page-style="background: #ffffff">
<navigation-bar title="{{pagetitle}}" loading="{{false}}" back styleType="dark" color="black" background="#ffffff" style="text-align: center;"></navigation-bar>
<view class="player-area">
  <player-comp
      id="player"
      isShowPlayer="{{false}}"
      isMoveable="{{false}}"
      narrationId="{{narrationId}}"
      showShareTextDialog="{{showShareTextDialog}}"
      bindReadyPlay="handleReadyPlay"
      bindTimeUpdate="handleTimeUpdate"
      bindEndAudio="handleEndAudio"
      bindOnPlayerStop="handleOnPlayerStop"
      bindOnPlayerEnded="handleOnPlayerEnded"
      bindOnPlayerPause="handleOnPlayerPause"
      bindOnPlayerPlay="handleOnPlayerPlay"
      bindGetCurPlayingStatus="handleGetCurPlayingStatus"
      bindShareTextTimeUp="handleShareTextTimeUp"
      bindCountdownEnd="handleCountdownEnd"
      bindClickAIPopup="handleClickAIPopup"
    ></player-comp>
</view>


<view class="exhibit-page">
  <view class="unit-choose-area">
    <swiper-unit list="{{unitList}}" selectedId="{{curUnitId}}" bindChangeUnit="handleChangeUnit"></swiper-unit>
    <view class="pannel-group">
      <image src="/static/images/{{!isListType ? 'list': 'qrcode'}}@2x.png" mode="aspectFit" class="pannel-img" catchtap="handleClickListType" />
      <view class="download">
        <cache-audio playingIndex="{{playingIndex}}" audiolist="{{audiolist}}"></cache-audio>
        <!-- <circle-progress id="download" total="{{100}}" progress="{{50}}"></circle-progress> -->
        <!-- <image src="/static/images/download@2x.png" mode="aspectFit" class="pannel-img" /> -->
      </view>
      <image src="/static/images/search@2x.png" mode="aspectFit" class="pannel-img" catchtap="handleClickPannelSearch" />
    </view>
  </view>
  <!-- <view class="unit-card-area">
    <swiper-card4
      list="{{exhibitList}}"
      currentIdx="{{playingIndex}}"
      bindSwiperItemClick="handleSwiperItemClick"
      bindSwiperItemChange="handleSwiperItemChange"
    ></swiper-card4>
  </view> -->
  <view class="list-area">
    <swiper-card6
        title=""
        isListType="{{isListType}}"
        showType="jiangjiedaoyu"
        showInput="{{false}}"
        list="{{exhibitList}}"
        scrollTop="{{continueScrollTop}}"
        audiolist="{{audiolist}}"
        listenedExhibitList="{{listenedExhibitList}}"
        playingExhibitId="{{curExhibit.id}}"
        playingIndex="{{playingIndex}}"
        bindChangeItem="handleClickExhibitItem"
        bindClickItemImage="handleClickItemImage"
        scrollStyle="height: calc({{safeAreaBottomHeight}} - 150rpx - 110rpx - {{listAreaHeight}} )"
      ></swiper-card6>
  </view>

  <view class="audio-player">
    <view class="audio-wrapper">
      <view class="img-group">
        <!-- <view class="img-bg" style=""></view>
        <view class="img-bg-white"></view> -->
        <view class="progress-container" catchtap="handleClickPlayerImg">
          <view class="progress-circle" style="--progress: {{currentTime/duration * 100}}%;">
            <image class="img-playing {{isPlay? 'img-animate': ''}}" src="{{curExhibit.image_url}}" mode="aspectFix" />
          </view>
        </view>
        <!-- <circle-progress id="{{curExhibit.id}}" curId="{{curExhibit.id}}" total="{{duration}}" progress="{{currentTime/duration}}"></circle-progress> -->
      </view>
      <view class="info-group">
        <view class="line-one">
          <view class="title">{{curExhibit.name}}</view>
          <view class="time">
            <text>{{currentTimeText}}</text>
            <text class="fenge">/</text>
            <text>{{totalTimeText}}</text>
          </view>

        </view>
        <view class="line-two">
          <image bindtap="handlePlayPrev" class="img-icon" src="/static/images/play-before{{playingIndex ? '': '-disable'}}.png" mode="aspectFix" />
          <image wx:if="{{!isPlay}}" bindtap="handleAudioPlay" class="img-icon play-icon" src="/static/images/play3.png" mode="aspectFix" />
          <image wx:else bindtap="handleAudioPause" class="img-icon pause-icon" src="/static/images/pause1.png" mode="aspectFill" />
          <image bindtap="handlePlayNext" class="img-icon reverse" src="/static/images/play-before{{(playingIndex + 1) === audiolist.length ? '-disable': ''}}.png" mode="aspectFix" />
          <view class="img-dingwei-group">
            <!-- <view class="img-wrapper" bindtap="handleOpenMapDialog">
              <image class="img" src="/static/images/play-huajuan.png" mode="aspectFix" />
            </view> -->
            <view class="img-wrapper" bindtap="handleClickOpenRate">
              <!-- <image src="/static/images/player-speed.png" class="img" mode="aspectFix" /> -->
              <view class="o-beisu-txt">x{{curRate}}</view>
            </view>
            <view class="img-wrapper" bindtap="handleClickRepeatPlaying">
              <image class="img" src="/static/images/{{isKeepPlayingActive ? 'xunhuan-1': 'xunhuan-p'}}.png" mode="aspectFix" />
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
  <view class="find-area">
    <dialog-half
      showIcon="{{true}}"
      showDialog="{{showFindDialog}}"
      bindCloseDialog="handleCloseFindDialog"
    >
    <view slot="content">
      <swiper-card6
        title="讲解导语"
        showType="guanjianci"
        showInput="{{showInput}}"
        playingExhibitId="{{curExhibit.id}}"
        list="{{searchList}}"
        playingIndex="{{playingIndex}}"
        bindClickSearch="handleClickSearch"
        bindChangeItem="handleClickSearchExhibitItem"
      ></swiper-card6>
    </view>
    </dialog-half>
  </view>

   <view class="map-area">
    <dialog-half
      fullHeight="{{false}}"
      showIcon="{{true}}"
      showDialog="{{showMapDialog}}"
      bindCloseDialog="handleCloseMapDialog"
    >
    <view slot="content">
      <view class="canvas-wrapper">
        <local-map id="map" Exhpoints="{{mapPoints}}" currentPointIdx="{{currentPointIdx}}"></local-map>
      </view>
    </view>
    </dialog-half>
  </view>

  <view class="rate-area">
    <dialog-half
      showDialog="{{showRateDialog}}"
      bindCloseDialog="handleCloseRateDialog"
    >
      <view slot="content">
        <view class="rate-group">
          <view class="title">倍速{{curRate}}x</view>
          
          <view class="rate-slider">
            <view class="fake-slider">
              <view class="dark-bg" style="width:{{800*(curRate-0.75) + 70}}rpx"></view>
              <view class="rate-txt-group">
                <view class="rate-speed">慢</view>
                <view class="rate-speed">快</view>
              </view>
              <view class="circle" style="transform: translateX({{800*(curRate-0.75)}}rpx)"><text class="rate-txt">{{curRate}}x</text></view>
          </view>
          <view class="real-slider">
            <slider
              block-color="#ffffff" 
              block-size="18"
              backgroundColor="rgba(44, 47, 59, 0.05)"
              activeColor="rgba(44, 47, 59, 0.05)"
              value="{{rateSlider}}"
              min="{{rateMin}}"
              max="{{rateMax}}"
              bindchange="handleRateSliderChange"
            >
            </slider>
          </view>
          
          </view>
          <view class="rate-number">
            <view class="rate-txt">0.75x</view>
            <view class="rate-txt">1x</view>
            <view class="rate-txt">1.25x</view>
            <view class="rate-txt">1.5x</view>
          </view>
        </view>
      </view>
    </dialog-half>
  </view>

  
</view>
</page-meta>  