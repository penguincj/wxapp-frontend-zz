<page-meta page-style="background: #000000;">
  <navigation-bar
    title="AI拍摄文物"
    back="{{true}}"
    color="white"
    background="#000000"
    styleType="light"
  >
    <!-- <view slot="right" class="flash-button" bindtap="handleToggleFlash">
      <text class="flash-icon">⚡</text>
      <text class="flash-label">{{flashModeLabel}}</text>
    </view> -->
  </navigation-bar>

  <view class="ai-camera-page">
    <view class="preview-area">
      <image class="preview-image" src="{{previewImage}}" mode="aspectFill"></image>
      <view wx:if="{{isRecognizing}}" class="recognizing-overlay">
        <view class="recognize-visual">
          <image class="recognize-bg" src="{{previewImage}}" mode="aspectFill"></image>
          <view class="recognize-frame">
            <view class="recognize-corner top-left"></view>
            <view class="recognize-corner top-right"></view>
            <view class="recognize-corner bottom-left"></view>
            <view class="recognize-corner bottom-right"></view>
            <view class="recognize-scan-line"></view>
          </view>
          <text class="recognize-hint">AI 正在识别这件宝物，请稍候…</text>
        </view>
      </view>
      <view wx:if="{{showExhibitOverlay && exhibitResult}}" class="exhibit-overlay">
        <view class="exhibit-card">
          <image class="exhibit-card-image" src="{{exhibitResult.image}}" mode="aspectFill"></image>
          <view class="exhibit-card-name">{{exhibitResult.name}}</view>
          <view class="exhibit-card-detail">{{exhibitResult.name === '当前不是文物' ?'当前不是文物，您可以返回重新拍摄': 'AI识别到这是'+exhibitResult.name+'，请确认是不是该文物' }}</view>
        </view>
        <view class="exhibit-action-row">
          <view class="exhibit-btn" bindtap="handleRetakeExhibit">
            <image class="exhibit-btn-icon" src="/static/images/ca-rotate.png" />
          </view>
          <view class="exhibit-btn primary" bindtap="handleConfirmExhibit">
            <image class="exhibit-btn-icon-big" src="/static/images/ca-yes.png" />
          </view>
          <view class="exhibit-btn" bindtap="handleCloseExhibitOverlay">
            <image class="exhibit-btn-icon" src="/static/images/ca-close.png" />
          </view>
        </view>
      </view>
      <view class="search-result" wx:if="{{showResultPage && exhibitDetail}}">
        <scroll-view scroll-y="{{true}}" class="search-result-scroll">
          <view class="result-hero">
            <image class="result-image" src="{{exhibitDetail.image_url}}" mode="aspectFill"></image>
            <view class="result-title">{{exhibitDetail.name}}</view>
          </view>
          <view class="result-section">
            <view class="section-title">文物名片</view>
            <view class="section-desc">{{exhibitDetail.content}}</view>
          </view>
          <view class="audio-section" wx:if="{{dailyListenExhibit}}">
            <daily-listen
              title=""
              exhibition="{{dailyListenExhibit}}"
              bindPlayDailyListen="handlePlayDailyListen"
            ></daily-listen>
          </view>
          <view class="result-footer">
            <text>识别内容不准确？点击查看</text>
            <text class="footer-link" bindtap="handleOpenMore">更多内容</text>
          </view>
        </scroll-view>
      </view>
      <view class="fankui-area" wx:if="{{showFeedbackForm}}">
        <scroll-view scroll-y="{{true}}" class="fankui-scroll">
          <view class="fankui-title">记录「考古」，分享给更多岛民</view>
          <image class="fankui-preview" src="{{exhibitDetail.image_url || previewImage}}" mode="aspectFill"></image>
          <view class="fankui-textbox">
            <textarea
              class="fankui-textarea"
              placeholder="写点鉴定依据吧～我们会更快的丰富藏宝库..."
              placeholder-class="fankui-placeholder"
              value="{{feedbackText}}"
              bindinput="handleFeedbackInput"
              maxlength="500"
            ></textarea>
            <view class="fankui-upload-list">
              <block wx:for="{{feedbackImages}}" wx:key="*this">
                <view class="upload-thumb">
                  <image src="{{item}}" mode="aspectFill"></image>
                  <view class="upload-remove" bindtap="handleRemoveFeedbackImage" data-index="{{index}}">×</view>
                </view>
              </block>
              <view class="upload-add" bindtap="handleAddFeedbackImage">
                <text class="upload-add-plus">+</text>
                <text class="upload-add-label">拍摄展签</text>
              </view>
            </view>
          </view>
          <view class="feedback-btnlist">
            <view class="feedback-cancel-btn" bindtap="handleCancelFeedback">取消</view>
            <view
            class="feedback-submit-btn"
            bindtap="handleSubmitFeedback"
            loading="{{submittingFeedback}}"
            disabled="{{submittingFeedback}}"
          >
            生成鉴定反馈
          </view>

          </view>
        </scroll-view>
      </view>
      <view wx:if="{{showFeedbackSuccessOverlay}}" class="feedback-success-overlay">
        <view class="feedback-success-card">
          <image
            class="feedback-success-image"
            src="/static/images/airobot.png"
            mode="aspectFit"
          ></image>
          <text class="feedback-success-title">已将鉴定请求发送给博物岛屿平台，努力丰富宝藏库中，谢谢理解～</text>
          <view
            class="feedback-success-button"
            bindtap="handleFeedbackSuccessReturn"
          >
            返回
          </view>
        </view>
      </view>
      
    </view>

  </view>

  <custom-tab-bar></custom-tab-bar>
</page-meta>
